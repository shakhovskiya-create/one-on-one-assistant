# Спецификация расхождений: Макеты vs Реализация

**Дата:** 2026-01-26
**Тип:** GAP Analysis
**Статус:** Зафиксировано

---

## Сводная таблица расхождений

| # | Раздел | Тип | Приоритет | Описание |
|---|--------|-----|-----------|----------|
| GAP-001 | Dashboard | UI/UX | CRITICAL | Sidebar содержит элементы, которые должны быть в top-bar |
| GAP-002 | Tasks | UI/UX | HIGH | GitHub отсутствует в контекстном sidebar |
| GAP-003 | Tasks | Architecture | HIGH | Нет обязательной связи задача→проект |
| GAP-004 | Projects | Feature | MEDIUM | Отсутствует вложение документов |
| GAP-005 | System | Feature | CRITICAL | Сущность "Заявка на улучшение" НЕ РЕАЛИЗОВАНА |
| GAP-006 | Tasks | Feature | CRITICAL | Планирование ресурсов НЕ РЕАЛИЗОВАНО |
| GAP-007 | Tasks | Bug | CRITICAL | UI зависает при загрузке зависимостей |
| GAP-008 | Meetings | UI/UX | HIGH | Реализация НЕ соответствует макету календаря |
| GAP-009 | Tasks | UI/UX | HIGH | Отсутствуют: тестирование, документация, roadmap в sidebar |
| GAP-010 | System | Feature | CRITICAL | Service Desk НЕ РЕАЛИЗОВАН |
| GAP-011 | Mail | Architecture | MEDIUM | Нет SSO, требуется повторная аутентификация |
| GAP-012 | Profile | UI/UX | LOW | Дублирование профиля, неполное ФИО |

---

## Детальное описание расхождений

### GAP-001: Dashboard — неправильный sidebar

**Раздел:** Dashboard (главная страница)
**Тип:** UI/UX расхождение
**Приоритет:** CRITICAL

**ФАКТ (текущая реализация):**
Левый sidebar содержит:
- Сообщения
- Почта
- Confluence
- GitHub
- Настройки

**ТРЕБОВАНИЕ (согласованный макет):**
Эти элементы должны быть в TOP-BAR (справа), не в sidebar.

**Файл реализации:** `frontend/src/lib/components/Sidebar.svelte`
**Файл макета:** `ai_org/deliverables/prototypes/01-tasks.html`

**Причина расхождения:** Не выяснена. Требуется аудит истории изменений.

---

### GAP-002: Tasks — отсутствует GitHub в sidebar

**Раздел:** Задачи
**Тип:** UI/UX расхождение
**Приоритет:** HIGH

**ФАКТ:**
GitHub отсутствует в sidebar раздела Задачи.
При этом GitHub есть в Dashboard sidebar (где он НЕ нужен).

**ТРЕБОВАНИЕ:**
GitHub (коммиты, PR) должен быть в контексте задач.

**Файл реализации:** `frontend/src/lib/components/Sidebar.svelte:35-45`

---

### GAP-003: Tasks — нет обязательной связи с проектом

**Раздел:** Задачи
**Тип:** Архитектурное расхождение
**Приоритет:** HIGH

**ФАКТ:**
Задачи могут существовать без проекта.
`project_id` в таблице `tasks` — nullable.

**ТРЕБОВАНИЕ:**
Проект — ОБЯЗАТЕЛЬНЫЙ контекст для задачи.

**Файл:** `migrations/` — schema tasks, `backend/internal/models/models.go`

---

### GAP-004: Projects — нет вложения документов

**Раздел:** Проекты
**Тип:** Отсутствующий функционал
**Приоритет:** MEDIUM

**ФАКТ:**
В проектах нельзя прикрепить документы.

**ТРЕБОВАНИЕ:**
Проект должен содержать прикреплённые документы.

---

### GAP-005: Заявка на улучшение — НЕ РЕАЛИЗОВАНА

**Раздел:** Система (новая сущность)
**Тип:** Отсутствующий функционал
**Приоритет:** CRITICAL

**ФАКТ:**
Сущность "Заявка на улучшение" полностью отсутствует:
- Нет таблицы в БД
- Нет модели в backend
- Нет UI
- Нет API

**ТРЕБОВАНИЕ (полный workflow):**
1. Создание заявки пользователем
2. Процесс согласования (этапы)
3. Формирование обоснования
4. Вынесение на комитет
5. Получение/отклонение бюджета
6. Создание ПРОЕКТА с атрибутами:
   - Бюджет
   - Сроки
   - Ответственный
   - Статус
   - Этапы

**Упоминание в документации:** НЕТ (отсутствует в WORKPLAN.md)

---

### GAP-006: Планирование ресурсов — НЕ РЕАЛИЗОВАНО

**Раздел:** Задачи
**Тип:** Отсутствующий функционал
**Приоритет:** CRITICAL

**ФАКТ:**
Планирование ресурсов полностью отсутствует.

**ТРЕБОВАНИЕ:**
В задаче должно быть видно:
- Кто исполнитель
- Сколько у исполнителя уже занято времени
- Сколько свободных часов в месяц
- Общая загрузка ресурса

**Статус в WORKPLAN.md:** "Планирование ресурсов" отмечено как частично реализованное, но фактически НЕ работает.

---

### GAP-007: Зависимости задач — БАГ, зависание UI

**Раздел:** Задачи
**Тип:** Критический дефект
**Приоритет:** CRITICAL (блокирует работу)

**ФАКТ (симптомы):**
- При открытии задачи интерфейс зависает
- Зависимости блокируют загрузку
- Постоянный индикатор загрузки
- Карточка не открывается

**Возможные причины:**
1. Бесконечный цикл при загрузке зависимостей
2. API возвращает ошибку, не обрабатывается
3. Блокировка UI thread

**Файлы для анализа:**
- `frontend/src/routes/tasks/+page.svelte` — loadTaskDetails()
- `backend/internal/handlers/tasks.go` — GetTaskDependencies

---

### GAP-008: Meetings — НЕ соответствует макету

**Раздел:** Встречи
**Тип:** UI/UX расхождение
**Приоритет:** HIGH

**ФАКТ:**
Текущая реализация календаря принципиально отличается от утверждённого макета.

**Файл макета:** `ai_org/deliverables/prototypes/04-meetings.html`
**Файл реализации:** `frontend/src/routes/meetings/+page.svelte`

**Конкретные расхождения:** Требуется детальное сравнение.

---

### GAP-009: Tasks sidebar — отсутствуют разделы

**Раздел:** Задачи
**Тип:** UI/UX расхождение
**Приоритет:** HIGH

**ФАКТ (отсутствует в sidebar):**
- Тестирование (тест-планы, тест-кейсы)
- Документация (требования, wiki)
- Спринты (управление)
- Roadmap / Gantt

**ТРЕБОВАНИЕ (из макета 01-tasks.html):**
Полный project management sidebar с этими разделами.

---

### GAP-010: Service Desk — НЕ РЕАЛИЗОВАН

**Раздел:** Система
**Тип:** Отсутствующий функционал
**Приоритет:** CRITICAL

**ФАКТ:**
Service Desk полностью отсутствует:
- Нет страницы
- Нет API
- Нет модели

**Файлы макетов:**
- `ai_org/deliverables/prototypes/02-service-desk-portal.html`
- `ai_org/deliverables/prototypes/03-service-desk-agent.html`

**Статус:** Был согласован, был в макетах, НЕ реализован.

---

### GAP-011: Почта — нет SSO

**Раздел:** Почта
**Тип:** Архитектурная ошибка
**Приоритет:** MEDIUM

**ФАКТ:**
Система требует повторный вход в почту через логин/пароль.

**ТРЕБОВАНИЕ:**
Сквозная аутентификация (SSO) — если пользователь авторизован в портале, почта должна работать автоматически.

**Файлы:**
- `frontend/src/routes/mail/+page.svelte`
- `backend/internal/handlers/mail.go`

---

### GAP-012: Профиль — дублирование, неполное ФИО

**Раздел:** Профиль пользователя
**Тип:** UI/UX расхождение
**Приоритет:** LOW

**ФАКТ:**
- Отображается только фамилия (было ФИО)
- Профиль дублируется в top-bar и sidebar

**ТРЕБОВАНИЕ:**
- Полное ФИО
- Профиль только в одном месте (top-bar)

**Файлы:**
- `frontend/src/lib/components/GlobalNav.svelte:82`
- `frontend/src/lib/components/Sidebar.svelte`

---

## Матрица влияния

| GAP | Backend | Frontend | DB | Новая сущность |
|-----|---------|----------|----|----------------|
| GAP-001 | — | ✓ | — | — |
| GAP-002 | — | ✓ | — | — |
| GAP-003 | ✓ | ✓ | ✓ | — |
| GAP-004 | ✓ | ✓ | ✓ | — |
| GAP-005 | ✓ | ✓ | ✓ | ImprovementRequest |
| GAP-006 | ✓ | ✓ | ✓ | ResourceAllocation |
| GAP-007 | ? | ✓ | — | — |
| GAP-008 | — | ✓ | — | — |
| GAP-009 | — | ✓ | — | — |
| GAP-010 | ✓ | ✓ | ✓ | Ticket, Category, SLA |
| GAP-011 | ✓ | ✓ | — | — |
| GAP-012 | — | ✓ | — | — |

---

## Рекомендации

### Немедленные действия (CRITICAL):
1. **GAP-007** — Исправить баг зависимостей (блокирует работу)
2. **GAP-001** — Исправить навигацию (top-bar vs sidebar)

### Следующий спринт (HIGH):
3. **GAP-005** — Спроектировать и реализовать "Заявка на улучшение"
4. **GAP-006** — Спроектировать и реализовать планирование ресурсов
5. **GAP-010** — Реализовать Service Desk (минимальный MVP)

### Backlog (MEDIUM/LOW):
6. **GAP-003** — Обязательная связь задача→проект
7. **GAP-008** — Привести Meetings в соответствие макету
8. **GAP-009** — Расширить sidebar Tasks
9. **GAP-011** — SSO для почты
10. **GAP-012** — Исправить профиль
