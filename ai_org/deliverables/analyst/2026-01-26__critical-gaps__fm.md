# Функциональная модель EKF Hub (целевое состояние)

**Дата:** 2026-01-26
**Контекст:** Анализ критических расхождений
**Статус:** Требует валидации владельцем продукта

---

## 1. Архитектура навигации (ЦЕЛЕВАЯ)

### 1.1 Глобальный Top-Bar
```
┌─────────────────────────────────────────────────────────────────────┐
│ [EKF Hub]  Дашборд | Задачи | Встречи | Сотрудники | Аналитика     │
│                                                                     │
│                         [Сообщения] [Почта] [Уведомления] [Профиль] │
└─────────────────────────────────────────────────────────────────────┘
```

**Элементы справа (top-bar):**
- Сообщения (иконка + счётчик)
- Почта (иконка + счётчик непрочитанных)
- Confluence (быстрый доступ)
- GitHub (быстрый доступ)
- Уведомления (bell icon)
- Профиль (аватар + полное ФИО)

### 1.2 Контекстный Sidebar (по разделам)

#### Раздел: Задачи
```
┌─────────────────────┐
│ Проект: [выбор] ▼   │
├─────────────────────┤
│ 📊 Планирование     │
│   ├─ Доска задач    │
│   ├─ Бэклог         │
│   ├─ Roadmap        │
│   └─ Gantt          │
├─────────────────────┤
│ 🏃 Спринты          │
│   ├─ Sprint N (акт) │
│   ├─ Sprint N+1     │
│   └─ Архив          │
├─────────────────────┤
│ 🚀 Релизы           │
│   ├─ v2.1 (dev)     │
│   ├─ v2.0 (prod)    │
│   └─ Архив          │
├─────────────────────┤
│ 🧪 Тестирование     │
│   ├─ Тест-планы     │
│   ├─ Тест-кейсы     │
│   └─ Прогоны        │
├─────────────────────┤
│ 📚 Документация     │
│   ├─ Требования     │
│   ├─ Wiki           │
│   └─ Архитектура    │
├─────────────────────┤
│ 🔗 Интеграции       │
│   ├─ GitHub         │
│   └─ Confluence     │
└─────────────────────┘
```

#### Раздел: Встречи
```
┌─────────────────────┐
│ 📅 Календарь        │
│   ├─ Мой календарь  │
│   ├─ Команда        │
│   └─ Переговорные   │
├─────────────────────┤
│ 📝 Встречи          │
│   ├─ Предстоящие    │
│   ├─ Прошедшие      │
│   └─ Без протокола  │
├─────────────────────┤
│ 🎙️ Записи           │
│   ├─ Транскрипции   │
│   └─ AI Анализ      │
└─────────────────────┘
```

---

## 2. Недостающие сущности

### 2.1 Заявка на улучшение (ImprovementRequest)

**Жизненный цикл:**
```
Черновик → На согласовании → Обоснование → Комитет → Утверждено → Проект
                ↓                               ↓
            Отклонено                      Отклонено
```

**Атрибуты:**
| Поле | Тип | Описание |
|------|-----|----------|
| id | UUID | Идентификатор |
| title | string | Название улучшения |
| description | text | Описание проблемы/потребности |
| business_value | text | Бизнес-ценность |
| initiator_id | UUID | Инициатор (Employee) |
| department_id | UUID | Департамент |
| estimated_budget | decimal | Предварительный бюджет |
| estimated_duration | interval | Предварительные сроки |
| status | enum | Статус жизненного цикла |
| committee_date | date | Дата рассмотрения комитетом |
| committee_decision | text | Решение комитета |
| project_id | UUID | Созданный проект (после утверждения) |
| created_at | timestamp | Дата создания |
| updated_at | timestamp | Дата обновления |

**Связи:**
- → Project (после утверждения)
- → Employee (инициатор)
- → Department (департамент-заказчик)
- → Attachments (документы обоснования)

### 2.2 Service Desk

**Сущности:**
- **Ticket** — заявка в Service Desk
- **Category** — категория заявки
- **SLA** — правила SLA
- **Queue** — очередь обработки

**Ticket атрибуты:**
| Поле | Тип | Описание |
|------|-----|----------|
| id | UUID | Идентификатор |
| number | string | Номер заявки (SD-00001) |
| title | string | Тема |
| description | text | Описание |
| category_id | UUID | Категория |
| priority | enum | Приоритет (low/medium/high/critical) |
| status | enum | Статус |
| requester_id | UUID | Заявитель |
| assignee_id | UUID | Исполнитель |
| sla_deadline | timestamp | Крайний срок по SLA |
| resolution | text | Решение |
| created_at | timestamp | — |
| resolved_at | timestamp | — |

### 2.3 Планирование ресурсов

**Расширение Employee:**
| Поле | Тип | Описание |
|------|-----|----------|
| work_hours_per_month | int | Норма часов в месяц (по умолчанию 160) |
| hourly_rate | decimal | Ставка в час (для расчёта стоимости) |

**Новая сущность: ResourceAllocation**
| Поле | Тип | Описание |
|------|-----|----------|
| id | UUID | — |
| employee_id | UUID | Сотрудник |
| task_id | UUID | Задача |
| allocated_hours | int | Выделено часов |
| period_start | date | Начало периода |
| period_end | date | Конец периода |

**Вычисляемые метрики:**
- `allocated_total` — сумма выделенных часов за период
- `available_hours` — work_hours_per_month - allocated_total
- `utilization_percent` — allocated_total / work_hours_per_month * 100

---

## 3. Расширение существующих сущностей

### 3.1 Project (расширение)

**Новые поля:**
| Поле | Тип | Описание |
|------|-----|----------|
| budget | decimal | Утверждённый бюджет |
| actual_cost | decimal | Фактические затраты |
| start_date | date | Дата начала |
| end_date | date | Плановая дата окончания |
| responsible_id | UUID | Ответственный (руководитель проекта) |
| improvement_request_id | UUID | Связь с заявкой на улучшение |
| documents | relation | Прикреплённые документы |

**Связи:**
- → Tasks (задачи проекта) — ОБЯЗАТЕЛЬНАЯ связь
- → ImprovementRequest (источник проекта)
- → Documents (документация)
- → Employees (команда проекта)

### 3.2 Task (расширение)

**Обязательные связи:**
| Поле | Обязательность | Описание |
|------|----------------|----------|
| project_id | REQUIRED | Задача всегда в контексте проекта |

---

## 4. Профиль пользователя

**Отображение:**
- Только в top-bar (справа)
- Полное ФИО (Фамилия Имя Отчество)
- Аватар (фото из AD или инициалы)
- Dropdown с меню: Профиль, Настройки, Выход

**Убрать:**
- Дублирование в sidebar

---

## 5. Приоритеты реализации

| # | Компонент | Приоритет | Обоснование |
|---|-----------|-----------|-------------|
| 1 | Исправить навигацию (top-bar) | CRITICAL | Базовый UX |
| 2 | Bugfix: зависимости задач | CRITICAL | Блокирует работу |
| 3 | Планирование ресурсов | HIGH | Ключевой функционал |
| 4 | Заявка на улучшение | HIGH | Бизнес-процесс |
| 5 | Service Desk | HIGH | Был согласован |
| 6 | SSO для почты | MEDIUM | Удобство |
| 7 | Соответствие макетам Meetings | MEDIUM | UX |
| 8 | Документы в проектах | MEDIUM | Функционал |
