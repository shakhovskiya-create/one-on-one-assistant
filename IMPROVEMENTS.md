# –ü—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ EKF Hub

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### 1. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (–ö—Ä–∏—Ç–∏—á–Ω–æ)

- ‚úÖ –£–±—Ä–∞–Ω —Ö–∞—Ä–¥–∫–æ–¥ –ø–∞—Ä–æ–ª—è –ë–î –∏–∑ docker-compose.yml
- ‚úÖ –ó–∞–∫—Ä—ã—Ç –ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ PostgreSQL (–ø–æ—Ä—Ç 5432 —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ Docker —Å–µ—Ç–∏)
- ‚úÖ –ó–∞–∫—Ä—ã—Ç –ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ backend (–ø–æ—Ä—Ç 8080 —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ nginx)
- ‚úÖ –ó–∞–∫—Ä—ã—Ç –ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ frontend (–ø–æ—Ä—Ç 3000 —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ nginx)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã health checks –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- ‚úÖ –£–ª—É—á—à–µ–Ω .env.example —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- ‚úÖ –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é AD_SKIP_VERIFY –∏ EWS_SKIP_TLS_VERIFY —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤ false

### 1.1 Security Audit Fixes (2026-01-21)

- ‚úÖ **–£–¥–∞–ª–µ–Ω–æ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è –≤ sessionStorage** ‚Äî EWS credentials –±–æ–ª—å—à–µ –Ω–µ –∫—ç—à–∏—Ä—É—é—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ
- ‚úÖ **Credentials —Ç–æ–ª—å–∫–æ –∏–∑ body** ‚Äî —É–±—Ä–∞–Ω fallback –Ω–∞ query params (URL logging risk)
- ‚úÖ **JWT_SECRET required** ‚Äî –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ —Å—Ç–∞—Ä—Ç—É–µ—Ç –±–µ–∑ —è–≤–Ω–æ –∑–∞–¥–∞–Ω–Ω–æ–≥–æ —Å–µ–∫—Ä–µ—Ç–∞
- ‚úÖ **Rate limiting** ‚Äî Auth: 5 req/min, API: 100 req/min per IP
- ‚úÖ **CSRF protection** ‚Äî middleware + endpoint /api/v1/csrf-token
- ‚úÖ **crypto/rand** ‚Äî –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏ —Å—Ç–æ–π–∫–∏–π RNG –¥–ª—è —Ç–æ–∫–µ–Ω–æ–≤
- ‚úÖ **PostgreSQL sslmode=prefer** ‚Äî TLS –ø—Ä–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
- ‚úÖ **–£–±—Ä–∞–Ω–∞ debug info** ‚Äî domain/url –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –≤ auth responses
- ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö** ‚Äî pkg/validation/validator.go
- ‚úÖ **–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî internal/utils/logger.go

### 1.2 Sprint 10 Security Fixes (2026-01-26)

- ‚úÖ **IDOR Protection (10.2-10.3)** ‚Äî RBAC middleware –¥–ª—è employees/calendar endpoints
  - `internal/middleware/rbac.go` ‚Äî Role-Based Access Control —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∏–µ—Ä–∞—Ä—Ö–∏–∏ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤
  - GetEmployeeDossier: —Ç–æ–ª—å–∫–æ self/manager/HR/admin
  - GetMyTeam: —Ç–æ–ª—å–∫–æ self/admin/HR
  - GetCalendar: —Ç–æ–ª—å–∫–æ self/manager/admin/HR

- ‚úÖ **XSS Prevention (10.4)** ‚Äî DOMPurify –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
  - `frontend/src/lib/sanitizer.ts` ‚Äî —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è HTML
  - Confluence –∏ Mail –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ç–µ–ø–µ—Ä—å –±–µ–∑–æ–ø–∞—Å–Ω—ã –æ—Ç XSS —á–µ—Ä–µ–∑ {@html}

- ‚úÖ **JWT/WS Token Security (10.5-10.6)** ‚Äî HttpOnly cookies
  - `internal/middleware/auth.go` ‚Äî SetAuthCookie/ClearAuthCookie —Å HttpOnly, Secure, SameSite=Lax
  - Dual-path auth: Authorization header (API clients) + Cookie (browser)
  - WebSocket: —Ç–æ–∫–µ–Ω –∏–∑ cookie, –Ω–µ –∏–∑ URL (–ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —É—Ç–µ—á–∫—É –≤ –ª–æ–≥–∞—Ö)
  - Frontend: `credentials: 'include'` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ cookies
  - Logout endpoint –æ—á–∏—â–∞–µ—Ç HttpOnly cookie

- ‚úÖ **TLS/SSL Security (10.7-10.8)** ‚Äî Security validation –Ω–∞ —Å—Ç–∞—Ä—Ç–µ
  - `internal/config/config.go` ‚Äî ValidateSecuritySettings() —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è–º–∏
  - –ü—Ä–æ–≤–µ—Ä–∫–∞: AD_SKIP_VERIFY, EWS_SKIP_TLS_VERIFY, DATABASE_URL sslmode, MINIO_USE_SSL
  - `.env.example` –æ–±–Ω–æ–≤–ª—ë–Ω —Å secure defaults (sslmode=require, MINIO_USE_SSL=true)

- ‚úÖ **File Upload Validation (10.10)** ‚Äî MIME/size/whitelist
  - `internal/handlers/files.go` ‚Äî validateFileUpload() —Å magic bytes detection
  - Extension whitelist: pdf, docx, xlsx, jpg, png, webp, etc.
  - Dangerous extensions blacklist: exe, php, js, bat, etc.
  - Size limits: 50MB general, 10MB images
  - `internal/handlers/speech.go` ‚Äî validateAudioUpload() –¥–ª—è –∞—É–¥–∏–æ —Ñ–∞–π–ª–æ–≤

### 2. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

- ‚úÖ –í–∫–ª—é—á–µ–Ω nginx reverse proxy
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ Redis –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã health checks –¥–ª—è –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è nginx —Å security headers
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ gzip compression

### 3. –ë—ç–∫–∞–ø—ã

- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã PostgreSQL
- ‚úÖ –ë—ç–∫–∞–ø—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ /opt/one-on-one/backups
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –±—ç–∫–∞–ø–æ–≤ —Å—Ç–∞—Ä—à–µ 7 –¥–Ω–µ–π

### 4. UX

- ‚úÖ –°–æ–∑–¥–∞–Ω favicon.svg –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- ‚úÖ –£–ª—É—á—à–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ .env.example

### 5. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

- ‚úÖ –£–ª—É—á—à–µ–Ω nginx.conf —Å security headers
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ SSL (–∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ, –≥–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é)
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã —Ç–∞–π–º–∞—É—Ç—ã –∏ keepalive connections

## üìù –¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞

### Backend –∫–æ–¥ (—Ç—Ä–µ–±—É–µ—Ç –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏)

1. ~~**–í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö**~~ ‚úÖ DONE
   - ~~–°–æ–∑–¥–∞—Ç—å pkg/validation/validator.go~~
   - ‚è≥ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤–æ –≤—Å–µ handlers (—á–∞—Å—Ç–∏—á–Ω–æ)

2. ~~**–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**~~ ‚úÖ DONE
   - ~~–°–æ–∑–¥–∞—Ç—å pkg/logger/logger.go~~ ‚Üí internal/utils/logger.go
   - ‚è≥ –ó–∞–º–µ–Ω–∏—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π log –Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π (—á–∞—Å—Ç–∏—á–Ω–æ)

3. **Redis –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - –°–æ–∑–¥–∞—Ç—å pkg/cache/redis.go
   - –î–æ–±–∞–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å github.com/redis/go-redis/v9 –≤ go.mod
   - –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ handlers

4. ~~**–£–ª—É—á—à–µ–Ω–Ω—ã–µ health checks**~~ ‚úÖ DONE
   - ~~–†–∞—Å—à–∏—Ä–∏—Ç—å /health endpoint~~
   - ~~–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ë–î~~
   - ‚è≥ –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É Redis (–ø–æ—Å–ª–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏)

### Frontend

1. **Favicon**
   - –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å favicon.svg –≤ build
   - –û–±–Ω–æ–≤–∏—Ç—å app.html –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è favicon

2. ~~**–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**~~ ‚úÖ DONE
   - ~~–£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –≤ API client~~ ‚Üí frontend/src/lib/utils/errorHandler.ts
   - ‚è≥ –î–æ–±–∞–≤–∏—Ç—å retry –ª–æ–≥–∏–∫—É (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

3. **CSRF –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** (–Ω–æ–≤–æ–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ –∞—É–¥–∏—Ç–∞)
   - –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—É—á–µ–Ω–∏–µ CSRF —Ç–æ–∫–µ–Ω–∞ –ø—Ä–∏ –ª–æ–≥–∏–Ω–µ
   - –î–æ–±–∞–≤–∏—Ç—å X-CSRF-Token header –∫ state-changing –∑–∞–ø—Ä–æ—Å–∞–º

### SSL/HTTPS

1. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤**
   - –ü–æ–ª—É—á–∏—Ç—å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã (Let's Encrypt –∏–ª–∏ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ)
   - –†–∞–∑–º–µ—Å—Ç–∏—Ç—å –≤ nginx/ssl/
   - –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å HTTPS –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ nginx.conf

## üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é

### 1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ .env —Ñ–∞–π–ª–∞

```bash
# –û–±–Ω–æ–≤–∏—Ç–µ .env —Ñ–∞–π–ª —Å –Ω–æ–≤—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏:
JWT_EXPIRATION_HOURS=2
LOG_LEVEL=info
REDIS_URL=redis://redis:6379
AD_SKIP_VERIFY=false  # –í production
EWS_SKIP_TLS_VERIFY=false  # –í production
```

### 2. –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫

```bash
cd /opt/one-on-one/app
docker-compose down
docker-compose build
docker-compose up -d
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose ps

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker-compose logs -f

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å health checks
curl http://localhost/health
```

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSL (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```bash
# –†–∞–∑–º–µ—Å—Ç–∏—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –≤ nginx/ssl/
# –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ HTTPS —Å–µ–∫—Ü–∏—é –≤ nginx.conf
# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ nginx
docker-compose restart nginx
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–ü–∞—Ä–æ–ª–∏ –∏ —Å–µ–∫—Ä–µ—Ç—ã**: –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–∏—Ç–µ –≤—Å–µ –ø–∞—Ä–æ–ª–∏ –∏ —Å–µ–∫—Ä–µ—Ç—ã –≤ .env —Ñ–∞–π–ª–µ
2. **TLS –ø—Ä–æ–≤–µ—Ä–∫–∞**: –í production —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ AD_SKIP_VERIFY=false –∏ EWS_SKIP_TLS_VERIFY=false
3. **–ë—ç–∫–∞–ø—ã**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è /opt/one-on-one/backups —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è –∑–∞–ø–∏—Å–∏
4. **Redis**: Redis –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ—Å–ª–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤ backend –∫–æ–¥

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –ø–æ–≤—ã—à–µ–Ω–∞ –∑–∞ —Å—á—ë—Ç –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ—Ä—Ç–æ–≤ –∏ —É–ª—É—á—à–µ–Ω–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: Redis –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —É–ª—É—á—à–∏—Ç –≤—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞
- **–ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å**: Health checks –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã –ø–æ–≤—ã—Å—è—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —É–ø—Ä–æ—Å—Ç–∏—Ç –æ—Ç–ª–∞–¥–∫—É
